#!/bin/bash

########################################################################################

# helper functions:
###################

# $1: Database
is_empty_db() {
	for item in "$1"/*
	do
		if [[ -f "$item" ]]
		then
			is_empty_table "$item"
		elif [[ -d "$item"  ]]
		then
			is_empty_db "$item"
		else
			echo -n
		fi
		
		if [[ $? -eq 1 ]]
		then
			return 1
		fi
	done
	return 0
}

# $1: Table
is_empty_table() {
    if [[ -s "$1" ]]
    then
        return 1
    fi
    return 0
}


########################################################################################

# main functions:
#################

# $1: Database or Table to be created
# $2: 'db': Database, 'table': Table
# $3: success message
# $4: error message
create() {
	if [[ -e "$1" ]]
	then
		echo "$4"
		return 1
	fi

	if [[ $2 == 'db' ]]
	then
		mkdir "$1"
	elif [[ $2 == 'table' ]]
	then
		touch "$1"
	else
        echo "Invalid Type."
		return 1
	fi
	
	echo "$3"
	return 0
}

# $1: Database or Table to be checked
check() {
	if [[ -e "$1" ]]
	then
		return 0
	fi

	return 1
}

# $1: Database or Table to be deleted
# $2: 'db': Database, 'table': Table
# $3: success message
# $4: error message
delete() {
    if [[ ! -e "$1" ]]
    then
        echo "$4"
        return 1
    fi

    if [[ $2 == "db" ]]
    then
        if ! is_empty_db "$1"
        then
            echo "The Database is not empty, are you sure you want to delete it?"
        fi
    elif [[ $2 == "table" ]]
    then
        if ! is_empty_table "$1"
        then
            echo "The Table is not empty, are you sure you want to delete it?"
        fi
    else
        echo "Invalid Type."
        return 1
    fi
    
    rm -r "$1"
    echo "$3"
    return 0
}


# $1: parent directory
# $2: old name
rename(){
	read -p "Please enter the new name: " new_name
	mv "$1/$2" "$1/$new_name"
	echo "'$2' is renamed successfully to '$new_name'"
}


########################################################################################

# exports:
##########
export -f create
export -f check
export -f delete
export -f rename
